<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chroméa - Capture d'image</title>
    <style>
        :root {
            --primary-bg: #111;
            --primary-accent: #00ffcc;
            --secondary-accent: #4267B2;
            --tertiary-accent: #362777;
            --text-light: #ffffff;
            --text-dark: #111;
            --card-bg: rgba(24, 44, 76, 0.15);
            --gradient-1: linear-gradient(135deg, #00ffcc 0%, #00A993 100%);
            --gradient-2: linear-gradient(135deg, #4267B2 0%, #2A4899 100%);
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.25);
            --border-radius: 12px;
        }
        
        @font-face {
            font-family: 'Mikodacs';
            src: url('Mikodacs.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden; /* Empêche tout scroll */
            font-family: 'Fira Mono', 'Consolas', monospace, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            background: var(--primary-bg);
            color: var(--text-light);
            /* SVG de fond : réduction de la taille des motifs à 60px comme sur la page 1 */
            background-image: url('data:image/svg+xml;utf8,<svg width="60" height="60" xmlns="http://www.w3.org/2000/svg"><circle cx="15" cy="15" r="8" fill="none" stroke="%23222" stroke-width="1.2"/><circle cx="45" cy="15" r="8" fill="none" stroke="%23222" stroke-width="1.2"/><circle cx="15" cy="45" r="8" fill="none" stroke="%23222" stroke-width="1.2"/><circle cx="45" cy="45" r="8" fill="none" stroke="%23222" stroke-width="1.2"/><polyline points="45,0 45,15 15,15 15,45 45,45 45,60" fill="none" stroke="%23222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" opacity="0.7"/></svg>');
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Réajuster le padding pour avoir une meilleure disposition verticale */
            padding: 60px 20px 10px;
        }
        
        #app-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            min-width: 340px;
            max-width: 100vw;
            height: 50px; /* Hauteur réduite */
            background: linear-gradient(180deg, #182c4c 0%, #111 100%) !important;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 2px 8px #0008;
        }
        
        #banner-content {
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: center; /* Centrer le titre au lieu de space-between */
            align-items: center;
            padding: 0 15px;
        }
        
        h1 {
            font-family: 'Mikodacs', serif;
            font-size: 1.5rem; /* Taille réduite */
            color: var(--primary-accent);
            font-weight: 700;
            letter-spacing: 0.04em;
            text-shadow: 
                0 0 8px rgba(0, 255, 204, 0.4),
                0 0 16px rgba(0, 255, 204, 0.2);
            margin: 0; /* Enlever les marges */
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto 15px;
            background: rgba(24, 44, 76, 0.13);
            backdrop-filter: blur(12px);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow-soft);
            border: 2px solid rgba(0, 255, 204, 0.13);
            /* Hauteur maximum pour s'assurer de tout contenir */
            max-height: calc(100vh - 130px);
        }
        
        .mode-toggle {
            display: flex;
            border-radius: 30px;
            overflow: hidden;
            margin: 0 auto 25px;
            width: 300px;
            border: 2px solid var(--primary-accent);
            box-shadow: 0 2px 16px rgba(0, 255, 204, 0.2);
        }
        
        .mode-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: rgba(0, 0, 0, 0.2);
            color: var(--primary-accent);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: 'Fira Mono', 'Consolas', monospace;
            letter-spacing: 1px;
        }
        
        .mode-btn.active {
            background: var(--primary-accent);
            color: var(--text-dark);
            box-shadow: 0 2px 10px rgba(0, 255, 204, 0.4);
        }
        
        #videoContainer, #photoContainer {
            position: relative;
            width: 100%;
            max-width: 500px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-soft);
            background-color: #131c50; /* Sera remplacé par un dégradé aléatoire */
            aspect-ratio: 4/3;
            margin: 0 auto 10px; /* Marge réduite */
            border: 2px solid rgba(0, 255, 204, 0.2);
        }
        
        /* Nouveau style pour le placeholder de la caméra avec dégradé */
        #videoPlaceholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Fira Mono', 'Consolas', monospace;
            font-size: 0.9rem;
            text-align: center;
            padding: 0 20px;
            background: linear-gradient(135deg, #00A993, #E68B4A); /* Sera défini dynamiquement */
        }
        
        #video, #canvas, #photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: calc(var(--border-radius) - 2px);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 15px; /* Marge réduite */
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 8px 18px; /* Padding réduit */
            font-size: 0.85rem; /* Taille réduite */
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: 'Fira Mono', 'Consolas', monospace;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .primary {
            background: rgba(0, 255, 204, 0.13);
            color: var(--primary-accent);
            border: 2px solid var(--primary-accent);
            box-shadow: 0 2px 16px rgba(0, 255, 204, 0.2), 0 1px 8px rgba(0, 0, 0, 0.3);
        }
        
        .secondary {
            background: var(--primary-accent);
            color: var(--text-dark);
            border: 2px solid var(--primary-accent);
            box-shadow: 0 2px 16px rgba(0, 255, 204, 0.2), 0 1px 8px rgba(0, 0, 0, 0.3);
        }
        
        .danger {
            background: rgba(255, 76, 76, 0.13);
            color: #FF4C4C;
            border: 2px solid #FF4C4C;
            box-shadow: 0 2px 16px rgba(255, 76, 76, 0.2), 0 1px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
        }
        
        button.primary:hover {
            background: var(--primary-accent);
            color: var(--text-dark);
        }
        
        button.danger:hover {
            background: #FF4C4C;
            color: white;
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            width: 100%;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            aspect-ratio: 1/1;
            border: 1px solid rgba(0, 255, 204, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-accent);
        }
        
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 76, 76, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .delete-btn:hover {
            background: rgba(255, 50, 50, 1);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 76, 76, 0.6);
        }
        
        .hidden {
            display: none;
        }
        
        .status-message {
            margin: 10px auto; /* Marge réduite */
            padding: 8px 15px; /* Padding réduit */
            border-radius: 12px;
            background: rgba(0, 255, 204, 0.07);
            backdrop-filter: blur(5px);
            max-width: 80%;
            font-size: 0.85rem; /* Taille réduite */
            color: var(--primary-accent);
            border: 1px solid rgba(0, 255, 204, 0.2);
            animation: pulse 2s infinite ease-in-out;
            font-family: 'Fira Mono', 'Consolas', monospace;
            letter-spacing: 0.5px;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; box-shadow: 0 0 5px rgba(0, 255, 204, 0.1); }
            50% { opacity: 1; box-shadow: 0 0 12px rgba(0, 255, 204, 0.3); }
            100% { opacity: 0.8; box-shadow: 0 0 5px rgba(0, 255, 204, 0.1); }
        }
        
        .effects-panel {
            display: flex;
            gap: 10px;
            margin: 20px auto;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 500px;
        }
        
        .effect-btn {
            padding: 8px 15px;
            font-size: 0.85rem;
            border: 1px solid rgba(0, 255, 204, 0.3);
            border-radius: 20px;
            background: rgba(0, 255, 204, 0.05);
            color: var(--primary-accent);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Mono', 'Consolas', monospace;
            letter-spacing: 0.5px;
        }
        
        .effect-btn.active {
            background: var(--primary-accent);
            color: var(--text-dark);
            box-shadow: 0 0 16px rgba(0, 255, 204, 0.4);
        }
        
        .color-info {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(7, 17, 77, 0.8);
            backdrop-filter: blur(5px);
            color: white;
            padding: 8px;
            font-size: 12px;
            border-top: 1px solid rgba(0, 255, 204, 0.2);
            font-family: 'Fira Mono', 'Consolas', monospace;
            letter-spacing: 0.5px;
        }
        
        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            color: var(--primary-accent);
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 8px rgba(0, 255, 204, 0.2);
            font-family: 'Fira Mono', 'Consolas', monospace;
            letter-spacing: 1px;
        }
        
        @keyframes blink {
            from { opacity: 1; }
            to { opacity: 0.3; }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 1.2rem;
            }
            
            .container {
                padding: 10px;
                margin: 0 5px 10px;
                max-height: calc(100vh - 100px);
            }
            
            .mode-toggle {
                width: 90%;
            }
            
            .button-group {
                gap: 8px;
            }
            
            button {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            #app-banner {
                height: 60px;
                min-width: 100vw;
                padding-left: 0;
                padding-right: 0;
            }
            
            html, body {
                padding-top: 70px;
                padding-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="app-banner">
        <div id="banner-content">
            <h1>Capteur d'Images Chroméa</h1>
        </div>
    </div>
    
    <div class="mode-toggle">
        <button class="mode-btn active" id="cameraMode">Mode Caméra</button>
        <button class="mode-btn" id="galleryMode">Galerie Photos</button>
    </div>

    <div class="container" id="cameraModeContainer">
        <div id="videoContainer">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" class="hidden"></canvas>
            <div id="videoPlaceholder">En attente d'activation de la caméra...</div>
        </div>

        <div class="effects-panel">
            <button class="effect-btn active" data-filter="normal">Normal</button>
            <button class="effect-btn" data-filter="grayscale">Noir & Blanc</button>
            <button class="effect-btn" data-filter="sepia">Sépia</button>
            <button class="effect-btn" data-filter="invert">Négatif</button>
        </div>

        <div class="button-group">
            <button id="switchCamera" class="primary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 3a5 5 0 0 0-5 5v1h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V8a6 6 0 0 1 6-6h4.5L10 4.5l.7.7L14.2 2l-3.5-3.2-.7.7L12.5 2H8z"/>
                </svg>
                Changer de caméra
            </button>
            <button id="captureBtn" class="secondary">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"/>
                    <path d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                </svg>
                Capturer l'image
            </button>
        </div>
        
        <p id="statusMessage" class="status-message">Initialisation de la caméra...</p>
    </div>

    <div class="container hidden" id="galleryModeContainer">
        <h2>Images Capturées</h2>
        <div class="gallery" id="photoGallery"></div>
        <div class="button-group">
            <button id="clearAllBtn" class="danger">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                </svg>
                Supprimer toutes les images
            </button>
        </div>
    </div>

    <script>
        // Variables globales
        let stream;
        let currentFilter = 'normal';
        let facingMode = 'user'; // Par défaut, caméra frontale
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusMessage = document.getElementById('statusMessage');
        const photoGallery = document.getElementById('photoGallery');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        let photos = JSON.parse(localStorage.getItem('capturedPhotos')) || [];
        
        // Définir les dégradés possibles
        const gradientMap = {
            "#00A993": "#E68B4A", "#E68B4A": "#7A1619", "#7A1619": "#362777",
            "#362777": "#EB7AAE", "#EB7AAE": "#0069AA", "#0069AA": "#DC0C15",
            "#DC0C15": "#E03A8D", "#E03A8D": "#FFFFFF", "#FFFFFF": "#2A4899",
            "#2A4899": "#00A993"
        };
        
        // Fonction pour choisir un dégradé aléatoire
        function setRandomGradient() {
            const colors = Object.entries(gradientMap);
            const randomIndex = Math.floor(Math.random() * colors.length);
            const [startColor, endColor] = [colors[randomIndex][0], colors[randomIndex][1]];
            videoPlaceholder.style.background = `linear-gradient(135deg, ${startColor}, ${endColor})`;
        }
        
        // Appliquer un dégradé aléatoire au démarrage
        setRandomGradient();
        
        // Changer de mode (caméra ou galerie)
        document.getElementById('cameraMode').addEventListener('click', () => {
            document.getElementById('cameraMode').classList.add('active');
            document.getElementById('galleryMode').classList.remove('active');
            document.getElementById('cameraModeContainer').classList.remove('hidden');
            document.getElementById('galleryModeContainer').classList.add('hidden');
        });

        document.getElementById('galleryMode').addEventListener('click', () => {
            document.getElementById('galleryMode').classList.add('active');
            document.getElementById('cameraMode').classList.remove('active');
            document.getElementById('cameraModeContainer').classList.add('hidden');
            document.getElementById('galleryModeContainer').classList.remove('hidden');
            loadGallery();
        });

        // Gestion des effets
        document.querySelectorAll('.effect-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.effect-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                applyVideoFilter();
            });
        });

        // Fonction pour appliquer les filtres à la vidéo
        function applyVideoFilter() {
            switch(currentFilter) {
                case 'grayscale':
                    video.style.filter = 'grayscale(100%)';
                    break;
                case 'sepia':
                    video.style.filter = 'sepia(100%)';
                    break;
                case 'invert':
                    video.style.filter = 'invert(100%)';
                    break;
                default:
                    video.style.filter = 'none';
            }
        }

        // Initialiser la caméra
        async function initCamera() {
            try {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // Masquer le placeholder une fois la caméra activée
                videoPlaceholder.style.display = 'none';
                
                // Définir les dimensions du canvas pour correspondre à la vidéo
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    statusMessage.textContent = 'Caméra prête. Vous pouvez prendre une photo.';
                };

                applyVideoFilter();
            } catch (error) {
                statusMessage.textContent = `Erreur d'accès à la caméra: ${error.message}`;
                console.error('Erreur d\'accès à la caméra:', error);
                // Afficher à nouveau le placeholder en cas d'erreur
                videoPlaceholder.style.display = 'flex';
                // Changer le message d'erreur dans le placeholder
                videoPlaceholder.textContent = `Erreur d'accès à la caméra: ${error.message}`;
            }
        }

        // Changer de caméra
        document.getElementById('switchCamera').addEventListener('click', () => {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            initCamera();
        });

        // Fonction pour extraire la couleur dominante d'une image
        function extractDominantColor(imageData) {
            const data = imageData.data;
            const colorCounts = {};
            const step = 5; // Analyser un pixel sur 5 pour améliorer les performances
            
            // Analyser les pixels et compter les occurrences de chaque couleur
            for (let i = 0; i < data.length; i += 4 * step) {
                // Ignorer les pixels transparents
                if (data[i + 3] < 128) continue;
                
                // Simplifier les valeurs RGB pour réduire le nombre total de couleurs
                const r = Math.floor(data[i] / 10) * 10;
                const g = Math.floor(data[i + 1] / 10) * 10;
                const b = Math.floor(data[i + 2] / 10) * 10;
                
                const colorKey = `${r},${g},${b}`;
                
                if (!colorCounts[colorKey]) {
                    colorCounts[colorKey] = 0;
                }
                colorCounts[colorKey]++;
            }
            
            // Trouver la couleur avec le plus grand nombre d'occurrences
            let maxCount = 0;
            let dominantColor = '0,0,0';
            
            for (const colorKey in colorCounts) {
                if (colorCounts[colorKey] > maxCount) {
                    maxCount = colorCounts[colorKey];
                    dominantColor = colorKey;
                }
            }
            
            const [r, g, b] = dominantColor.split(',').map(Number);
            return {
                rgb: `rgb(${r}, ${g}, ${b})`,
                hex: `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`
            };
        }

        // Capturer une photo
        document.getElementById('captureBtn').addEventListener('click', () => {
            // Dessiner l'image actuelle de la vidéo sur le canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Appliquer le même filtre au canvas
            let filterCSS = '';
            switch(currentFilter) {
                case 'grayscale':
                    filterCSS = 'grayscale(100%)';
                    break;
                case 'sepia':
                    filterCSS = 'sepia(100%)';
                    break;
                case 'invert':
                    filterCSS = 'invert(100%)';
                    break;
            }
            
            if (filterCSS) {
                ctx.filter = filterCSS;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                ctx.filter = 'none';
            }
            
            // Extraire la couleur dominante
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const dominantColor = extractDominantColor(imageData);
            
            // Convertir en URL data
            const photoDataUrl = canvas.toDataURL('image/jpeg');
            
            // Sauvegarder la photo avec la couleur dominante
            savePhoto(photoDataUrl, dominantColor);
            
            // Afficher message de confirmation
            statusMessage.textContent = 'Photo capturée et enregistrée!';
            setTimeout(() => {
                statusMessage.textContent = 'Caméra prête. Vous pouvez prendre une photo.';
            }, 2000);
        });

        // Sauvegarder une photo
        function savePhoto(dataUrl, dominantColor) {
            const timestamp = new Date().toISOString();
            photos.push({
                id: Date.now().toString(),
                url: dataUrl,
                timestamp: timestamp,
                dominantColor: dominantColor
            });
            localStorage.setItem('capturedPhotos', JSON.stringify(photos));
        }

        // Charger la galerie de photos
        function loadGallery() {
            photoGallery.innerHTML = '';
            
            if (photos.length === 0) {
                photoGallery.innerHTML = '<p>Aucune photo dans la galerie. Prenez des photos pour les voir ici.</p>';
                return;
            }
            
            photos.forEach((photo, index) => {
                const photoElement = document.createElement('div');
                photoElement.className = 'gallery-item';
                
                // Vérifier si la photo a une couleur dominante (pour la compatibilité avec les anciennes photos)
                const dominantColor = photo.dominantColor || { rgb: 'rgb(128, 128, 128)', hex: '#808080' };
                
                photoElement.innerHTML = `
                    <img class="gallery-img" src="${photo.url}" alt="Photo ${index + 1}">
                    <button class="delete-btn" data-id="${photo.id}">✕</button>
                    <div class="color-info">
                        <div class="color-swatch" style="background-color: ${dominantColor.rgb}"></div>
                        <span>${dominantColor.hex}</span>
                    </div>
                `;
                photoGallery.appendChild(photoElement);
            });

            // Ajouter des gestionnaires d'événements pour les boutons de suppression
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const photoId = e.target.dataset.id;
                    deletePhoto(photoId);
                });
            });
        }

        // Supprimer une photo
        function deletePhoto(photoId) {
            photos = photos.filter(photo => photo.id !== photoId);
            localStorage.setItem('capturedPhotos', JSON.stringify(photos));
            loadGallery();
        }

        // Supprimer toutes les photos
        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (confirm('Êtes-vous sûr de vouloir supprimer toutes les photos?')) {
                photos = [];
                localStorage.setItem('capturedPhotos', JSON.stringify(photos));
                loadGallery();
            }
        });

        // Vérifier si le navigateur prend en charge getUserMedia
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            statusMessage.textContent = 'Votre navigateur ne prend pas en charge l\'accès à la caméra.';
            videoPlaceholder.textContent = 'Votre navigateur ne prend pas en charge l\'accès à la caméra.';
        } else {
            initCamera();
        }
    </script>
</body>
</html>