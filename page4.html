<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Photo Web</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f0f2f5;
        }
        h1 {
            color: #4267B2;
            margin-bottom: 30px;
        }
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        #videoContainer, #photoContainer {
            position: relative;
            width: 100%;
            max-width: 500px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: #333;
            aspect-ratio: 4/3;
        }
        #video, #canvas, #photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .primary {
            background-color: #4267B2;
            color: white;
        }
        .secondary {
            background-color: #42B72A;
            color: white;
        }
        .danger {
            background-color: #FF4C4C;
            color: white;
        }
        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 30px;
            width: 100%;
        }
        .gallery-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            aspect-ratio: 1/1;
        }
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mode-toggle {
            display: flex;
            border-radius: 30px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #4267B2;
        }
        .mode-btn {
            padding: 10px 20px;
            border: none;
            background-color: #e4e6eb;
            color: #4267B2;
            cursor: pointer;
            font-weight: bold;
        }
        .mode-btn.active {
            background-color: #4267B2;
            color: white;
        }
        .hidden {
            display: none;
        }
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #e4e6eb;
        }
        .effects-panel {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .effect-btn {
            padding: 8px 15px;
            font-size: 14px;
            border: 2px solid #4267B2;
            border-radius: 20px;
            background-color: white;
            color: #4267B2;
            cursor: pointer;
        }
        .effect-btn.active {
            background-color: #4267B2;
            color: white;
        }
    </style>
</head>
<body>
    <h1>üì∑ Application Photo Web</h1>
    
    <div class="mode-toggle">
        <button class="mode-btn active" id="cameraMode">Mode Cam√©ra</button>
        <button class="mode-btn" id="galleryMode">Galerie Photos</button>
    </div>

    <div class="container" id="cameraModeContainer">
        <div id="videoContainer">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas" class="hidden"></canvas>
        </div>

        <div class="effects-panel">
            <button class="effect-btn active" data-filter="normal">Normal</button>
            <button class="effect-btn" data-filter="grayscale">Noir & Blanc</button>
            <button class="effect-btn" data-filter="sepia">S√©pia</button>
            <button class="effect-btn" data-filter="invert">N√©gatif</button>
        </div>

        <div class="button-group">
            <button id="switchCamera" class="primary">Changer de cam√©ra</button>
            <button id="captureBtn" class="secondary">üì∏ Prendre une photo</button>
        </div>
        
        <p id="statusMessage" class="status-message">Initialisation de la cam√©ra...</p>
    </div>

    <div class="container hidden" id="galleryModeContainer">
        <h2>Mes Photos</h2>
        <div class="gallery" id="photoGallery"></div>
        <div class="button-group">
            <button id="clearAllBtn" class="danger">Supprimer toutes les photos</button>
        </div>
    </div>

    <script>
        // Variables globales
        let stream;
        let currentFilter = 'normal';
        let facingMode = 'user'; // Par d√©faut, cam√©ra frontale
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusMessage = document.getElementById('statusMessage');
        const photoGallery = document.getElementById('photoGallery');
        let photos = JSON.parse(localStorage.getItem('capturedPhotos')) || [];

        // Changer de mode (cam√©ra ou galerie)
        document.getElementById('cameraMode').addEventListener('click', () => {
            document.getElementById('cameraMode').classList.add('active');
            document.getElementById('galleryMode').classList.remove('active');
            document.getElementById('cameraModeContainer').classList.remove('hidden');
            document.getElementById('galleryModeContainer').classList.add('hidden');
        });

        document.getElementById('galleryMode').addEventListener('click', () => {
            document.getElementById('galleryMode').classList.add('active');
            document.getElementById('cameraMode').classList.remove('active');
            document.getElementById('cameraModeContainer').classList.add('hidden');
            document.getElementById('galleryModeContainer').classList.remove('hidden');
            loadGallery();
        });

        // Gestion des effets
        document.querySelectorAll('.effect-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.effect-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                applyVideoFilter();
            });
        });

        // Fonction pour appliquer les filtres √† la vid√©o
        function applyVideoFilter() {
            switch(currentFilter) {
                case 'grayscale':
                    video.style.filter = 'grayscale(100%)';
                    break;
                case 'sepia':
                    video.style.filter = 'sepia(100%)';
                    break;
                case 'invert':
                    video.style.filter = 'invert(100%)';
                    break;
                default:
                    video.style.filter = 'none';
            }
        }

        // Initialiser la cam√©ra
        async function initCamera() {
            try {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // D√©finir les dimensions du canvas pour correspondre √† la vid√©o
                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    statusMessage.textContent = 'Cam√©ra pr√™te. Vous pouvez prendre une photo.';
                };

                applyVideoFilter();
            } catch (error) {
                statusMessage.textContent = `Erreur d'acc√®s √† la cam√©ra: ${error.message}`;
                console.error('Erreur d\'acc√®s √† la cam√©ra:', error);
            }
        }

        // Changer de cam√©ra
        document.getElementById('switchCamera').addEventListener('click', () => {
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            initCamera();
        });

        // Capturer une photo
        document.getElementById('captureBtn').addEventListener('click', () => {
            // Dessiner l'image actuelle de la vid√©o sur le canvas
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // Appliquer le m√™me filtre au canvas
            let filterCSS = '';
            switch(currentFilter) {
                case 'grayscale':
                    filterCSS = 'grayscale(100%)';
                    break;
                case 'sepia':
                    filterCSS = 'sepia(100%)';
                    break;
                case 'invert':
                    filterCSS = 'invert(100%)';
                    break;
            }
            
            if (filterCSS) {
                ctx.filter = filterCSS;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                ctx.filter = 'none';
            }
            
            // Convertir en URL data
            const photoDataUrl = canvas.toDataURL('image/jpeg');
            
            // Sauvegarder la photo
            savePhoto(photoDataUrl);
            
            // Afficher message de confirmation
            statusMessage.textContent = 'Photo captur√©e et enregistr√©e!';
            setTimeout(() => {
                statusMessage.textContent = 'Cam√©ra pr√™te. Vous pouvez prendre une photo.';
            }, 2000);
        });

        // Sauvegarder une photo
        function savePhoto(dataUrl) {
            const timestamp = new Date().toISOString();
            photos.push({
                id: Date.now().toString(),
                url: dataUrl,
                timestamp: timestamp
            });
            localStorage.setItem('capturedPhotos', JSON.stringify(photos));
        }

        // Charger la galerie de photos
        function loadGallery() {
            photoGallery.innerHTML = '';
            
            if (photos.length === 0) {
                photoGallery.innerHTML = '<p>Aucune photo dans la galerie. Prenez des photos pour les voir ici.</p>';
                return;
            }
            
            photos.forEach((photo, index) => {
                const photoElement = document.createElement('div');
                photoElement.className = 'gallery-item';
                photoElement.innerHTML = `
                    <img class="gallery-img" src="${photo.url}" alt="Photo ${index + 1}">
                    <button class="delete-btn" data-id="${photo.id}">‚úï</button>
                `;
                photoGallery.appendChild(photoElement);
            });

            // Ajouter des gestionnaires d'√©v√©nements pour les boutons de suppression
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const photoId = e.target.dataset.id;
                    deletePhoto(photoId);
                });
            });
        }

        // Supprimer une photo
        function deletePhoto(photoId) {
            photos = photos.filter(photo => photo.id !== photoId);
            localStorage.setItem('capturedPhotos', JSON.stringify(photos));
            loadGallery();
        }

        // Supprimer toutes les photos
        document.getElementById('clearAllBtn').addEventListener('click', () => {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer toutes les photos?')) {
                photos = [];
                localStorage.setItem('capturedPhotos', JSON.stringify(photos));
                loadGallery();
            }
        });

        // V√©rifier si le navigateur prend en charge getUserMedia
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            statusMessage.textContent = 'Votre navigateur ne prend pas en charge l\'acc√®s √† la cam√©ra.';
        } else {
            initCamera();
        }
    </script>
</body>
</html>